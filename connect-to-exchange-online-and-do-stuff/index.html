<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Connect to Exchange Online and Do Stuff - PDS IT Solutions</title><meta name="description" content="[et_pb_section fb_built='1' _builder_version='4.22.1' _module_preset='default' global_colors_info='{}'][et_pb_row column_structure='2_3,1_3' _builder_version='4.22.1' _module_preset='default' global_colors_info='{}'][et_pb_column type='2_3' _builder_version='4.22.1' _module_preset='default' global_colors_info='{}'][et_pb_heading title='Connect to Exchange Online and Do Stuff' _builder_version='4.22.1' _module_preset='default' title_font='|700|||||||' global_colors_info='{}'][/et_pb_heading][et_pb_text _builder_version='4.22.1' _module_preset='default' text_font='Inter||||||||' width='100%' custom_margin='-10px|||||' custom_padding='||0px|||' inline_fonts='Advent Pro' global_colors_info='{}'] This quick article explains how to connect to Exchange Online using PowerShell,&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script defer="defer" type="text/javascript" data-domain="pds-it-solutions.com" src="https://plausible.io/js/plausible.js"></script><script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script><link rel="canonical" href="https://www.pds-it-solutions.com/connect-to-exchange-online-and-do-stuff/"><link rel="alternate" type="application/atom+xml" href="https://www.pds-it-solutions.com/feed.xml"><link rel="alternate" type="application/json" href="https://www.pds-it-solutions.com/feed.json"><meta property="og:title" content="Connect to Exchange Online and Do Stuff"><meta property="og:image" content="https://www.pds-it-solutions.com/media/website/Color-logo-no-background.png"><meta property="og:image:width" content="3163"><meta property="og:image:height" content="1142"><meta property="og:site_name" content="PDS IT Solutions"><meta property="og:description" content="[et_pb_section fb_built='1' _builder_version='4.22.1' _module_preset='default' global_colors_info='{}'][et_pb_row column_structure='2_3,1_3' _builder_version='4.22.1' _module_preset='default' global_colors_info='{}'][et_pb_column type='2_3' _builder_version='4.22.1' _module_preset='default' global_colors_info='{}'][et_pb_heading title='Connect to Exchange Online and Do Stuff' _builder_version='4.22.1' _module_preset='default' title_font='|700|||||||' global_colors_info='{}'][/et_pb_heading][et_pb_text _builder_version='4.22.1' _module_preset='default' text_font='Inter||||||||' width='100%' custom_margin='-10px|||||' custom_padding='||0px|||' inline_fonts='Advent Pro' global_colors_info='{}'] This quick article explains how to connect to Exchange Online using PowerShell,&hellip;"><meta property="og:url" content="https://www.pds-it-solutions.com/connect-to-exchange-online-and-do-stuff/"><meta property="og:type" content="article"><link rel="stylesheet" href="https://www.pds-it-solutions.com/assets/css/style.css?v=a90ccfb4be7b0723bfa1a54a7e5b3d7a"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.pds-it-solutions.com/connect-to-exchange-online-and-do-stuff/"},"headline":"Connect to Exchange Online and Do Stuff","datePublished":"2023-08-31T18:50-06:00","dateModified":"2024-12-15T19:06-07:00","image":{"@type":"ImageObject","url":"https://www.pds-it-solutions.com/media/website/Color-logo-no-background.png","height":1142,"width":3163},"description":"[et_pb_section fb_built='1' _builder_version='4.22.1' _module_preset='default' global_colors_info='{}'][et_pb_row column_structure='2_3,1_3' _builder_version='4.22.1' _module_preset='default' global_colors_info='{}'][et_pb_column type='2_3' _builder_version='4.22.1' _module_preset='default' global_colors_info='{}'][et_pb_heading title='Connect to Exchange Online and Do Stuff' _builder_version='4.22.1' _module_preset='default' title_font='|700|||||||' global_colors_info='{}'][/et_pb_heading][et_pb_text _builder_version='4.22.1' _module_preset='default' text_font='Inter||||||||' width='100%' custom_margin='-10px|||||' custom_padding='||0px|||' inline_fonts='Advent Pro' global_colors_info='{}'] This quick article explains how to connect to Exchange Online using PowerShell,&hellip;","author":{"@type":"Person","name":"p Bryson","url":"https://www.pds-it-solutions.com/authors/p-bryson/"},"publisher":{"@type":"Organization","name":"p Bryson","logo":{"@type":"ImageObject","url":"https://www.pds-it-solutions.com/media/website/Color-logo-no-background.png","height":1142,"width":3163}}}</script><style></style><noscript><style>img[loading]{opacity:1;}</style></noscript></head><body class="page-template"><header class="topbar" id="js-header"><div class="topbar__inner"><a class="logo" href="https://www.pds-it-solutions.com/"><img src="https://www.pds-it-solutions.com/media/website/Color-logo-no-background.png" alt="PDS IT Solutions" width="3163" height="1142"></a><nav class="navbar"><button class="navbar__toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://www.pds-it-solutions.com/test-smtp-server-connection/" target="_self">Test SMTP Connections</a></li><li class="active"><a href="https://www.pds-it-solutions.com/connect-to-exchange-online-and-do-stuff/" target="_self">Exchange Online with Powershell</a></li></ul></nav></div></header><div class="main-content"><div class="infobar"><div class="infobar__update">Last Updated: <time datetime="2024-12-16T09:46">December 16, 2024</time></div></div><main class="main page"><article class="content"><header class="u-header content__header"><h1>Connect to Exchange Online and Do Stuff</h1></header><div class="content__entry u-inner"><p>[et_pb_section fb_built="1" _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][et_pb_row column_structure="2_3,1_3" _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][et_pb_column type="2_3" _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][et_pb_heading title="Connect to Exchange Online and Do Stuff" _builder_version="4.22.1" _module_preset="default" title_font="|700|||||||" global_colors_info="{}"][/et_pb_heading][et_pb_text _builder_version="4.22.1" _module_preset="default" text_font="Inter||||||||" width="100%" custom_margin="-10px|||||" custom_padding="||0px|||" inline_fonts="Advent Pro" global_colors_info="{}"]</p><p>This quick article explains how to connect to Exchange Online using PowerShell, and then how to do some stuff that I've had to do frequently.     I'll update it as Microsoft changes commands, or when I have new stuff I gotta do.</p><p>[/et_pb_text][/et_pb_column][et_pb_column type="1_3" _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][et_pb_image src="https://robutcandy-051f5774abc01864c677-endpoint.azureedge.net/blobrobutcandy2897d79516/wp-content/uploads/sites/7/2023/08/sillyRobut-Logo.png" title_text="sillyRobut Logo" url="https://www.sillyrobut.com" _builder_version="4.22.1" _module_preset="default" hover_enabled="0" global_colors_info="{}" sticky_enabled="0"][/et_pb_image][/et_pb_column][/et_pb_row][et_pb_row _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][et_pb_column type="4_4" _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][et_pb_divider _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][/et_pb_divider][et_pb_heading title="Install, Load, and Connect" _builder_version="4.22.1" _module_preset="default" title_level="h2" title_font="Inter||||||||" global_colors_info="{}"][/et_pb_heading][et_pb_tabs _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][et_pb_tab title="Windows" _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"]</p><p>First you gotta install some stuff.  I assume you already have PowerShell itself, so we'll skip that.  Search on PowerShellGallery.com for the latest version.   I like to throw the required version on there in case something goes goofy and it tries to install an old deprecated version.  Obviously you only need to do the install portion the first time, after that you can just import the module to do your work. </p><p><strong>Install-Module -Name ExchangeOnlineManagement -RequiredVersion 3.2.0</strong></p><p> Once that's in place, import the module.  </p><p><strong>Import-Module ExchangeOnlineManagement</strong></p><p>Now you need to connect to Exchange Online.  It's really easy...</p><p><strong>Connect-ExchangeOnline</strong></p><p>It will display your typical Microsoft Modern Auth login page.  Log in and confirm MFA on an account with Global Admin or Exchange Admin privileges.  </p><p>If it pukes, you might need to change your execution policy, but if it connected you can skip the Set-ExecutionPolicy commands.   I assume you know what you're doing, and you know what these commands do, and what can happen if you install other PS modules all willy-nilly.</p><p><strong>Set-ExecutionPolicy RemoteSigned</strong></p><p>and if that doesn't work, </p><p><strong>Set-ExecutionPolicy UnSigned</strong></p><p>[/et_pb_tab][et_pb_tab title="macOS" _builder_version="4.22.1" _module_preset="default" inline_fonts="Roboto Mono" global_colors_info="{}"]</p><p>Unlike the Windows side, I don't assume PowerShell is already installed on your Mac, so we'll start there.    I pulled these commands from Microsoft docs, but know that you're installing stuff and all the risks associated.  This whole thing requires HomeBrew, so we start with installing that.    Skip the HomeBrew install if you've already got it.</p><p> Open a terminal and run this command to install HomeBrew:</p><p><strong><span style="font-family: 'Roboto Mono';">/bin/bas<span style="color: #666666;">h -c "$(curl -fsSL <a href="https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot;" style="color: #666666;">https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"</a></span></span></strong></p><p>When that is done, you can use HomeBrew to install the actual PowerShell bits.   In the same terminal window, run this:</p><p><strong><span style="font-family: 'Roboto Mono';"></span><span style="font-family: 'Roboto Mono';">brew install --cask powershell</span></strong></p><p>Now check to see if it worked by running this:<strong><span style="font-family: 'Roboto Mono';"></span></strong></p><p><span style="font-family: 'Roboto Mono'; font-weight: normal;"><strong>pwsh</strong></span></p><p> From here, it's basically the same as Windows.   Search on PowerShellGallery.com for the latest version.   I like to throw the required version on there in case something goes goofy and it tries to install an old deprecated version.  Obviously you only need to do the install portion the first time, after that you can just import the module to do your work. </p><p><strong>Install-Module -Name ExchangeOnlineManagement -RequiredVersion 3.2.0</strong></p><p> Once that's in place, import the module.  </p><p><strong>Import-Module ExchangeOnlineManagement</strong></p><p>Now you need to connect to Exchange Online.  It's really easy...</p><p><strong>Connect-ExchangeOnline</strong></p><p>It will display your typical Microsoft Modern Auth login page.  Log in and confirm MFA on an account with Global Admin or Exchange Admin privileges.  </p><p><strong><span style="font-family: 'Roboto Mono';"></span></strong></p><p>[/et_pb_tab][/et_pb_tabs][et_pb_heading title="Frequent Commands I Use" _builder_version="4.22.1" _module_preset="default" title_level="h2" title_font="Inter||||||||" title_text_align="center" global_colors_info="{}"][/et_pb_heading][/et_pb_column][/et_pb_row][et_pb_row column_structure="3_4,1_4" _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][et_pb_column type="3_4" _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][et_pb_heading title="Mailbox Stats" _builder_version="4.22.1" _module_preset="default" title_level="h3" global_colors_info="{}"][/et_pb_heading][et_pb_text _builder_version="4.22.1" _module_preset="default" inline_fonts="DM Mono,Roboto Mono" global_colors_info="{}"]</p><p><span style="font-family: 'Roboto Mono'; font-weight: normal;"><span style="font-family: inherit;"><strong>Get-EXOMailboxStatistics -Identity "user@emaildomain.com"<br></strong></span><em>Find out how big a user's mailbox is.  Output looks like this:</em></span></p><p><span style="font-family: 'Roboto Mono'; font-weight: normal;"><b>DisplayName<span class="Apple-converted-space">          </span>: </b>User's Name<br><b>MailboxGuid<span class="Apple-converted-space">          </span>: </b>aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee<br><b>DeletedItemCount <span class="Apple-converted-space">    </span>: </b>40672<br><b>ItemCount<span class="Apple-converted-space">            </span>: </b>65624<br><b>TotalDeletedItemSize : </b>1.839 GB (1,974,531,829 bytes)<br><b>TotalItemSize<span class="Apple-converted-space">        </span>: </b>6.136 GB (6,588,478,477 bytes)</span></p><p>[/et_pb_text][et_pb_divider _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][/et_pb_divider][et_pb_heading title="Litigation Holds" _builder_version="4.22.1" _module_preset="default" title_level="h3" global_colors_info="{}"][/et_pb_heading][et_pb_text _builder_version="4.22.1" _module_preset="default" inline_fonts="DM Mono,Roboto Mono" global_colors_info="{}"]</p><p><span style="font-family: inherit;"><strong>Set-Mailbox "user@emaildomain.com" -LitigationHoldEnabled $false<br></strong></span><em>Turns off LitHold for the mailbox.    If the associated user doesn't have an M365 or Exchange Online license, and hasn't for like 60-90 days, it will just delete the mailbox entirely.    You've got it backed up somewhere, right?  RIGHT?!?</em><strong></strong></p><p><span style="font-family: inherit;"> <strong>Set-Mailbox "user@emaildomain.com" -LitigationHoldEnabled $true -LitigationHoldDuration NumOfDays</strong></span><br><em>Turns on LitHold for that many days.</em></p><p>[/et_pb_text][et_pb_divider _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][/et_pb_divider][et_pb_heading title="Manage Aliases" _builder_version="4.22.1" _module_preset="default" title_level="h3" global_colors_info="{}"][/et_pb_heading][et_pb_text _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"]</p><p><strong>Get-Mailbox "user@emaildomain.com" | select -ExpandProperty emailaddresses | Select-String "smtp"</strong><br><em>This shows the existing email addresses for the user.  The upper-case SMTP indicates the default address.</em></p><p><strong>Set-Mailbox "user@emaildomain.com" -EmailAddresses @{Add='alias@emaildomain.com'}</strong><br><em>Adds the alias.  Make sure you have admin permission, otherwise you get an error like "A parameter cannot be found that matches parameter name 'EmailAddress'</em></p><p><strong>Set-Mailbox "user@emaildomain.com" -EmailAddresses @{Remove='alias@emaildomain.com'}</strong><br><em>Pulls the alias from the user.   Again, be an admin to do this.</em></p><p><strong>Get-EXORecipient -Filter {EMailAddresses - like 'smtp:dude*'} </strong><br><em>This searches for anyone with the alias that begins with "dude". </em></p><p><strong>Get-EXORecipient -Filter {EmailAddresses -like 'smtp:dude*') | -Properties Name,EmailAddresses | Select Name, EmailAddresses<br></strong><em>If you have multiple "dude" aliases, this cleans it up a bit.</em></p><p><em></em></p><p>[/et_pb_text][et_pb_divider _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][/et_pb_divider][et_pb_heading title="Mess with Distribution Groups" _builder_version="4.22.1" _module_preset="default" title_level="h3" global_colors_info="{}"][/et_pb_heading][et_pb_text _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"]</p><p><strong>Get-DistributionGroupMember -Identity "GroupName"</strong><br><em>Lists all the members of the Distro.   If you get no errors and no output, there's nobody in it.  Remember that an "owner" isn't necessarily a member of the group.   </em></p><p><strong>Add-DistributionGroupMember -Identity "GroupName" -Member "user@emaildomain.com"</strong><br><em>This adds your user email to that Distro.  Re-run the above "Get" command and you should see someone in there now.  </em></p><p> <strong>New-DistributionGroup -Name "GroupName" -Type Distribution -ManagedBy "owner@emaildomain.com" -Members "one@emaildomain.com","two@emaildomain.com","three@emaildomain.com" -RequireSenderAuthentication $false</strong><br><em>Creates a new Distro. ManagedBy can be omitted, it will default to whoever you're creating it as.   Members don't have to be entered right then either, but you generally know at least one when you're doing it. The RequireSenderAuthentication being set to FALSE allows randos from the internet to be able to email the group.   Think external-facing DLs.  </em></p><p>Read up on Microsoft's documentation if you need more options.  <em></em></p><p><strong>Remove-DistributionGroupMember -Identity "GroupName" -Member "emailbeingremoved@emaildomain.com" -Confirm $false</strong><br><em>Pulls the user from the Distro.   You don't need the -Confirm $false bit, but if you omit it you'll get prompted before it does anything.   </em></p><p><em></em></p><p>[/et_pb_text][et_pb_divider _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][/et_pb_divider][et_pb_text _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"]</p><p>That's all for now.</p><p>[/et_pb_text][/et_pb_column][et_pb_column type="1_4" _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][et_pb_text _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"]</p><p><strong>Scripting vs Individual Commands</strong></p><p>You'll notice I don't write many, if any, true scripts.   I prefer to work with lists in Excel/Numbers, use CONCATENATE operations to build my PowerShell commands, and then paste those into the CLI.  This is because I like to know EXACTLY which objects I'm messing with.  All too often I've seen a script do mostly good work, but also mess with a user or mailbox object it shouldn't, and cause headache for everyone.    </p><p>I know in huge environments this can be a bit time consuming, but it's saved my bacon a few times.   </p><p>[/et_pb_text][et_pb_text _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"]</p><p><strong> Goofy Spacing and Line Widths</strong></p><p>Sometimes the line-breaks in this web editor I'm using are placed in crappy spots.   Parameters generally follow the -PARAMETER format, so make sure you're not adding any unnecessary spaces.</p><p>[/et_pb_text][/et_pb_column][/et_pb_row][et_pb_row column_structure="1_4,1_2,1_4" _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][et_pb_column type="1_4" _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][/et_pb_column][et_pb_column type="1_2" _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][et_pb_text _builder_version="4.22.1" _module_preset="default" hover_enabled="0" global_colors_info="{}" sticky_enabled="0"]</p><p style="text-align: center;"><a href="https://www.sillyrobut.com/abutt">About Me, Tracking Policies, Cookies, Privacy, and all that jazz.</a><br><span>© 2067 Time Travelers LLOLC &amp;&amp;  © 2023 Silly Robut Studios</span></p><p>[/et_pb_text][/et_pb_column][et_pb_column type="1_4" _builder_version="4.22.1" _module_preset="default" global_colors_info="{}"][/et_pb_column][/et_pb_row][/et_pb_section]</p></div></article></main><div class="sidebar"><section class="box authors"><h3 class="box__title">Authors</h3><ul class="authors__cotainer"><li class="authors__item"><div><a href="https://www.pds-it-solutions.com/authors/p-bryson/" class="authors__title">p Bryson</a> <span class="u-small">Post: 1</span></div></li></ul></section><section class="newsletter box box--gray"><h3 class="box__title">Newsletter</h3><p class="newsletter__description">Sign up to receive email updates and to hear what's going on with us!</p><form>...</form></section></div><footer class="footer"><a class="footer__logo" href="https://www.pds-it-solutions.com/"><img src="https://www.pds-it-solutions.com/media/website/Color-logo-no-background.png" alt="PDS IT Solutions" width="3163" height="1142"></a><nav><ul class="footer__nav"><li class="footer__nav-item"><a href="https://www.pds-it-solutions.com/test-smtp-server-connection/" target="_self">Test SMTP Connections</a></li><li class="footer__nav-item"><a href="https://www.pds-it-solutions.com/connect-to-exchange-online-and-do-stuff/" target="_self">Exchange Online with Powershell</a></li></ul></nav><div class="footer__copyright"><p>Made by Paul</p></div></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://www.pds-it-solutions.com/assets/js/scripts.min.js?v=18a65c58aef57c0287e0f0609f3389a9"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>